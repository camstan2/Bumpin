#!/usr/bin/env bash
set -euo pipefail

# Format staged Swift files
STAGED_SWIFT_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.swift$' || true)
if [ -n "$STAGED_SWIFT_FILES" ]; then
  if command -v swiftformat >/dev/null 2>&1; then
    swiftformat $STAGED_SWIFT_FILES || true
    # Re-stage after formatting
    echo "$STAGED_SWIFT_FILES" | xargs git add
  fi
fi

# Lint staged Swift files (non-blocking if swiftlint not installed)
if command -v swiftlint >/dev/null 2>&1; then
  echo "$STAGED_SWIFT_FILES" | xargs -I {} swiftlint lint --quiet --path {}
fi

exit 0


